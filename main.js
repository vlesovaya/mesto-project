(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_type_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},t={name:"Loading...",about:"Loading...",avatar:"",_id:""};function n(e,t,n,o){e.classList.remove(t),n.classList.remove(o),n.textContent=""}function o(e){e.setAttribute("disabled","disabled"),e.disabled=!0}function r(e,t){e.classList.remove(t),e.disabled=!1}function c(e,t,n){var c=e.querySelector(n);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?r(c):o(c)}var u={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-6",headers:{authorization:"74e98393-69db-4e2a-9095-4b722370b5b8","Content-Type":"application/json"}};function a(e,t,n){return fetch("".concat(u.baseUrl).concat(e),{method:t,headers:u.headers,body:n}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function l(t,n){t.querySelector(e.submitButtonSelector).textContent=n}function i(t){o(t.querySelector(e.submitButtonSelector))}var s=document.querySelector(".gallery__items"),f=document.forms["add-form"],d=document.querySelector(".popup_type_delete-card"),p=document.querySelector(".popup_type_add"),m=document.querySelector(".profile__add-button"),v=document.querySelector(".remove-button");function y(e,t){var n,o=e.target;l(d,"Удаление..."),i(d),(n=t,a("/cards/".concat(n),"DELETE",JSON.stringify({_id:n}))).then((function(e){o.closest(".gallery__item").remove(),z()})).catch((function(e){console.log("Ошибка. Запрос не выполнен. ".concat(e)),z()})),v.removeEventListener("click",y)}function _(n){var o=null!=n.likes.length?n.likes.length:0,c=n.likes.map((function(e){return e._id})).includes(t._id),u=n.owner._id===t._id,i=function(t,n,o,c,u,i){var s=document.querySelector("#gallery-template").content.querySelector(".gallery__item").cloneNode(!0),f=s.querySelector(".gallery__photo"),p=s.querySelector(".gallery__title"),m=s.querySelector(".gallery__like"),_=s.querySelector(".gallery_like-counter"),S=s.querySelector(".gallery__trash-button");return f.src=n,f.alt=t,_.textContent="".concat(o),p.textContent=t,c&&m.classList.add("gallery__like_active"),m.addEventListener("click",(function(e){e.target.classList.toggle("gallery__like_active"),function(e,t){return a("/cards/likes/".concat(t),e?"PUT":"DELETE",null)}(e.target.classList.contains("gallery__like_active"),i).then((function(e){var t=null!=e.likes.length?e.likes.length:0;_.textContent="".concat(t)})).catch((function(e){console.log("Ошибка. Запрос не выполнен. ".concat(e))}))})),u?S.addEventListener("click",(function(t){t.preventDefault(),G(d),l(d,"Да"),r(d.querySelector(e.submitButtonSelector)),v.addEventListener("click",(function(e){e.preventDefault(),y(t,i)}))})):S.style.display="none",f.addEventListener("click",(function(e){e.preventDefault(),function(e,t){G(B),J.src=t,J.alt=e,U.textContent=e}(t,n)})),s}(n.name,n.link,o,c,u,n._id);!function(e,t){e.prepend(t)}(s,i)}var S=document.querySelector(".popup_type_user-photo"),g=document.forms["user-photo-form"],b=document.querySelector(".profile__image"),h=document.querySelector(".profile__title"),q=document.querySelector(".profile__subtitle");function E(e){b.src=e}function L(e,t){h.textContent=e,q.textContent=t}function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){a=!0,c=e},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw c}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var A,O,x,D=document.querySelectorAll(".popup"),w=document.querySelector(".profile__edit-button"),j=document.querySelector(".popup_type_edit"),T=document.forms["edit-form"],B=document.querySelector(".popup_type_image"),P=document.querySelector(".profile__edit-image"),N=document.querySelector(".profile__title"),I=document.querySelector(".profile__subtitle"),J=B.querySelector(".image-popup__image"),U=B.querySelector(".image-popup__image-title");function G(e){e.classList.add("popup_opened"),document.addEventListener("keydown",M)}function H(t,o,r){var c,u,a,l,s;r.preventDefault(),G(t),c=o,a=(u=e).inputSelector,l=u.inputErrorClass,s=u.errorClass,Array.from(c.querySelectorAll(a)).filter((function(e){return e.classList.contains(l)})).forEach((function(e){var t=c.querySelector(".".concat(e.id,"-error"));n(e,l,t,s)})),o.reset(),i(o)}function M(e){"Escape"===e.key&&null!==document.querySelector(".popup_opened")&&z()}function z(){var e,t=k(D);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.classList.contains("popup_opened")&&n.classList.remove("popup_opened"),document.removeEventListener("keydown",M)}}catch(e){t.e(e)}finally{t.f()}}w.addEventListener("click",(function(e){l(T,"Сохранить"),H(j,T,e);var t=T.elements["user-name"],n=T.elements["about-me"];t.value=N.textContent,n.value=I.textContent})),m.addEventListener("click",(function(e){l(f,"Создать"),H(p,f,e)})),P.addEventListener("click",(function(e){l(g,"Сохранить"),H(S,g,e)})),function(){var e,t=k(D);try{for(t.s();!(e=t.n()).done;)e.value.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&(e.preventDefault(),z()),e.target.classList.contains("popup__close")&&(e.preventDefault(),z())}))}catch(e){t.e(e)}finally{t.f()}}(),T.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=T.elements["user-name"],r=T.elements["about-me"];l(T,"Сохранение..."),i(T),(t=o.value,n=r.value,a("/users/me","PATCH",JSON.stringify({name:t,about:n}))).then((function(e){L(o.value,r.value),z()})).catch((function(e){console.log("Ошибка. Запрос не выполнен. ".concat(e)),z()}))})),f.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=f.elements["image-title"],r=f.elements["image-link"];l(f,"Загрузка..."),i(f),(t=o.value,n=r.value,a("/cards","POST",JSON.stringify({name:t,link:n}))).then((function(e){_(e),z()})).catch((function(e){console.log("Ошибка. Запрос не выполнен. ".concat(e)),z()})),f.reset()})),g.addEventListener("submit",(function(e){e.preventDefault();var t,n=g.elements["photo-link"];i(g),l(g,"Загрузка..."),(t=n.value,a("/users/me/avatar","PATCH",JSON.stringify({avatar:t}))).then((function(e){E(n.value),z()})).catch((function(e){console.log("Ошибка. Запрос не выполнен. ".concat(e)),z()}))})),O=(A=e).formSelector,x=function(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(A,["formSelector"]),Array.from(document.querySelectorAll(O)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=t.inputSelector,r=t.inputErrorClass,u=t.errorClass,a=t.submitButtonSelector,l=(t.inactiveButtonClass,Array.from(e.querySelectorAll(o)));c(e,l,a),l.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.validity.valid?n(t,o,c,r):function(e,t,n,o,r){e.classList.add(t),n.textContent=r,n.classList.add(o)}(t,o,c,r,t.validationMessage)}(e,t,r,u),c(e,l,a)}))}))}(e,x)})),a("/users/me","GET",null).then((function(e){L(e.name,e.about),E(e.avatar),t._id=e._id,t.name=e.name,t.about=e.about,t.avatar=e.avatar,a("/cards","GET",null).then((function(e){e.reverse().forEach((function(e){_(e)}))})).catch((function(e){console.log("Ошибка. Запрос не выполнен. ".concat(e))}))})).catch((function(e){console.log("Ошибка. Запрос не выполнен. ".concat(e))}))})();